<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing - PF Creative AI Studio</title>
    
    <!-- Runtime configuration for API base - must be loaded BEFORE any other scripts -->
    <script src="runtime-config.js"></script>
    
    <!-- Centralized env; must be loaded AFTER runtime-config.js -->
    <script src="env.js"></script>
    
                <meta name="pf:apiBase" content="https://pfsystem-api-app-902383636494.asia-southeast1.run.app">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* ---------------- THEME ---------------- */
:root{
  --bg-0:#030114;
  --bg-1:#070621;
  --muted:#9aa0ad;
  --text:#f4f7fb;
  --purple:#8b5cff;
  --pink:#ff3fa6;
  --cyan:#35e1ff;
  --gold-1:#ffd66d;
  --gold-2:#ff9f5a;
  --card-radius:20px;
  --glass-border: rgba(255,255,255,0.06);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background: linear-gradient(180deg,var(--bg-0),var(--bg-1));
  color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  overflow-x:hidden;
}

/* ---------- full-screen canvases & overlays ---------- */
.bg-full{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.canvas-layer{position:absolute;inset:0;width:100%;height:100%;display:block}
.ribbon-svg{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;mix-blend-mode:screen}
.bloom{position:fixed;inset:0;z-index:2;pointer-events:none;background:
  radial-gradient(700px 300px at 12% 10%, rgba(139,92,246,0.12), transparent 8%),
  radial-gradient(700px 300px at 88% 86%, rgba(255,63,166,0.09), transparent 8%),
  radial-gradient(900px 420px at 50% 50%, rgba(65,217,255,0.04), transparent 10%);
  mix-blend-mode:screen;opacity:0.95;}
.vignette{position:fixed;inset:0;z-index:3;pointer-events:none;background:
  linear-gradient(180deg, rgba(0,0,0,0.22), transparent 40%);mix-blend-mode:multiply}

/* beam overlay canvas (for initial blast) */
#beamCanvas{position:fixed;inset:0;z-index:9;pointer-events:none;}

/* ---------- page layout ---------- */
.wrap{position:relative;z-index:5;max-width:1240px;margin:34px auto 120px;padding:28px 20px}
.early{display:inline-flex;align-items:center;gap:12px;padding:10px 18px;border-radius:999px;margin:0 auto 18px;background:linear-gradient(90deg, rgba(139,92,246,0.16), rgba(255,63,166,0.08));color:#fff;font-weight:800}
.header{text-align:center;margin-bottom:18px}
.header h1{margin:0;font-size:44px;font-weight:800;background:linear-gradient(90deg,#fff,rgba(255,255,255,0.95));-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 18px 48px rgba(0,0,0,0.6))}
.header p{margin:12px auto 0;color:var(--muted);max-width:820px;font-size:15px}

/* ---------- grid & cards ---------- */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:22px;margin-top:20px;align-items:stretch}
.card{
  position:relative;border-radius:var(--card-radius);padding:28px;min-height:540px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid var(--glass-border);backdrop-filter: blur(14px) saturate(140%);
  box-shadow:0 18px 70px rgba(0,0,0,0.6);transition:transform .34s,box-shadow .34s;overflow:hidden;
  transform:translateY(8px);
}
.card:hover{transform:translateY(-32px) scale(1.02) rotateX(0.6deg);box-shadow:0 70px 260px rgba(0,0,0,0.8), 0 0 120px rgba(139,92,246,0.06)}

/* --------- metallic gold border effect ---------
   Using pseudo-element to simulate reflective gilding.
   Animation sweeps a highlight across the border to mimic metal reflection.
   PRO card has stronger gold look.
   -------------------------------------------------*/
.card::before{
  content:""; position:absolute; inset:0; border-radius:var(--card-radius); padding:2px; pointer-events:none;
  background:
    linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  -webkit-mask: linear-gradient(#fff,#fff); mix-blend-mode:overlay;
}
.card::after{
  /* metallic rim */
  content:""; position:absolute; inset:-1.2px; border-radius:calc(var(--card-radius) + 1.2px); padding:0; pointer-events:none; z-index:6;
  background: conic-gradient(from 90deg at 50% 50%,
    rgba(255,255,255,0.06), rgba(255,215,120,0.18), rgba(255,215,120,0.26), rgba(255,255,255,0.06));
  -webkit-mask: linear-gradient(#000, #000);
  opacity:0.35; filter:blur(6px);
  transform:translateZ(0);
  transition:opacity .6s ease;
}
/* animated highlight sweep */
.card .rim-highlight{ position:absolute; inset:-1.2px; border-radius:calc(var(--card-radius) + 1.2px); pointer-events:none; z-index:7;
  background: linear-gradient(90deg, rgba(255,255,255,0.0), rgba(255,255,255,0.85) 45%, rgba(255,255,255,0.0) 65%);
  transform:translateX(-120%); filter:blur(12px); opacity:0; transition:opacity .35s; }
/* on hover sweep */
.card:hover .rim-highlight{ transform:translateX(120%); opacity:0.7; transition:transform .9s cubic-bezier(.2,.9,.2,1), opacity .35s; }

/* PRO stronger gold rim */
.card.pro::after{ background: conic-gradient(from 90deg at 50% 50%, rgba(255,240,200,0.02), rgba(255,215,120,0.32), rgba(255,200,100,0.36), rgba(255,240,200,0.02)); opacity:0.54; filter:blur(8px) }
.card.pro .rim-highlight{ background: linear-gradient(90deg, rgba(255,240,200,0.0), rgba(255,255,255,0.95) 40%, rgba(255,240,200,0.0) 72%); filter:blur(14px) }

/* sheen inside */
.sheen{position:absolute;left:-40%;bottom:-18%;width:180%;height:40%;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.06), rgba(255,255,255,0.02));transform:rotate(9deg);filter:blur(16px);opacity:0.04;pointer-events:none;transition:all .9s}
.card:hover .sheen{left:100%;opacity:0.14}

/* other card content */
.top{display:flex;justify-content:space-between;align-items:flex-start}
.plan-name{font-weight:800;color:var(--muted);font-size:13px}
.priceWrap{position:relative;margin-top:12px}
.price{font-size:56px;font-weight:900;line-height:0.9;background:linear-gradient(90deg,var(--purple),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 22px 60px rgba(139,92,246,0.08)}
.duration{margin-top:8px;color:var(--muted);font-size:14px}
.divider{height:1px;margin:18px 0;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.03))}
.features{flex:1;margin-top:8px}
.features li{list-style:none;display:flex;gap:12px;align-items:flex-start;margin-bottom:14px;color:var(--muted);font-size:15px}
.features svg{flex-shrink:0;margin-top:3px;color:var(--cyan)}

.cta{margin-top:18px}
.btn{display:inline-block;width:100%;padding:14px 16px;border-radius:14px;border:none;font-weight:900;font-size:15px;cursor:pointer;color:#08121a;background:linear-gradient(90deg,var(--gold-1),var(--gold-2));box-shadow:0 18px 70px rgba(255,200,120,0.12);position:relative;overflow:hidden}
.btn.alt{background:linear-gradient(90deg,var(--purple),var(--pink));color:#fff;box-shadow:0 16px 64px rgba(139,92,246,0.12)}
.btn::after{content:"";position:absolute;left:-40%;top:-40%;width:40%;height:200%;background:linear-gradient(90deg,rgba(255,255,255,0.22),rgba(255,255,255,0.04));transform:rotate(25deg);opacity:0.06;transition:all .6s}
.btn:hover::after{left:120%;opacity:0.14;transform:rotate(20deg)}
.btn:active::before{content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;border-radius:999px;background:rgba(0,0,0,0.06);animation:ripple .6s}
@keyframes ripple{from{opacity:0.9;transform:translate(-50%,-50%) scale(1)}to{opacity:0;transform:translate(-50%,-50%) scale(40)}}

/* price shake */
@keyframes popShake {
  0%{ transform: translateY(0) scale(1) }
  10%{ transform: translateY(-6px) scale(1.03) rotate(-1deg) }
  30%{ transform: translateY(6px) scale(0.995) rotate(1deg) }
  50%{ transform: translateY(-3px) scale(1.01) rotate(-0.6deg) }
  70%{ transform: translateY(2px) scale(0.998) rotate(0.6deg) }
  100%{ transform: translateY(0) scale(1) rotate(0) }
}
.price.pop{ animation: popShake 700ms cubic-bezier(.2,.9,.2,1); }

/* responsive */
@media (max-width:1024px){ .grid{grid-template-columns:1fr} .header h1{font-size:34px} .price{font-size:44px} .card{min-height:460px} }
  </style>
</head>
<body>
  <div class="bg-full" aria-hidden="true">
    <canvas id="nebula" class="canvas-layer"></canvas>
    <canvas id="particleLayer" class="canvas-layer"></canvas>
    <canvas id="network" class="canvas-layer"></canvas>

    <svg class="ribbon-svg" viewBox="0 0 1600 900" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#8b5cff" stop-opacity="0.16"/><stop offset="1" stop-color="#ff3fa6" stop-opacity="0.12"/></linearGradient>
        <linearGradient id="g2" x1="0" x2="1"><stop offset="0" stop-color="#ffd66d" stop-opacity="0.12"/><stop offset="1" stop-color="#ff9f5a" stop-opacity="0.08"/></linearGradient>
        <filter id="bb"><feGaussianBlur stdDeviation="40"/></filter>
      </defs>
      <path id="r1" d="M0,200 C400,100 800,300 1600,120 L1600,0 L0,0 Z" fill="url(#g1)" opacity="0.16" filter="url(#bb)"></path>
      <path id="r2" d="M0,700 C400,820 900,520 1600,640 L1600,900 L0,900 Z" fill="url(#g2)" opacity="0.12" filter="url(#bb)"></path>
    </svg>

    <div class="bloom"></div>
    <div class="vignette"></div>
  </div>

  <canvas id="beamCanvas"></canvas>

  <div class="wrap" role="main">
    <div class="early" role="banner" aria-live="polite">
      <div style="width:10px;height:10px;border-radius:99px;background:linear-gradient(90deg,var(--gold-1),var(--gold-2));box-shadow:0 0 14px rgba(255,160,80,0.6)"></div>
      ðŸ”¥ Early Bird â€” Limited Time Promotion!
      </div>

    <header class="header">
      <h1>Choose Your Creative Journey</h1>
      <p>All plans include <strong>Unlimited Projects</strong>, full creative styles access, AI Director features and premium resources.</p>
    </header>

    <section class="grid" aria-label="Pricing plans">
      <article class="card" id="card-beginner" aria-labelledby="beginner-label">
        <div class="rim-highlight"></div>
        <div class="sheen" aria-hidden="true"></div>
        <div class="top">
          <div>
            <div id="beginner-label" class="plan-name">Beginner</div>
            <div class="priceWrap">
              <div class="price" id="price-beginner">RM99</div>
              <div class="duration">Billed as one payment for <strong>1 Month</strong> access</div>
            </div>
          </div>
          <div style="text-align:right;color:var(--muted);font-size:12px">Limited Launch Offer</div>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <ul class="features">
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--cyan)"/></svg><div><strong>Unlimited Projects</strong><div style="color:var(--muted);font-size:13px">Create multi-scene projects without caps</div></div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/></svg><div>Access All Creative Styles</div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><div>Creative Fusion & Wildcard AI</div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="2"/></svg><div>Email Support</div></li>
        </ul>

        <div class="cta">
          <button class="btn alt" 
                  data-plan-id="beginner_1m" 
                  data-plan-name="Beginner Plan (1 Month)" 
                  data-amount="9900">Choose Beginner</button>
        </div>
      </article>

      <article class="card pro" id="card-pro" aria-labelledby="pro-label">
        <div class="badge">ðŸ‘‘ Best Value</div>
        <div class="rim-highlight"></div>
        <div class="sheen" aria-hidden="true"></div>
        <div class="top">
          <div>
            <div id="pro-label" class="plan-name">PRO</div>
            <div class="priceWrap">
              <div class="price" id="price-pro">RM297</div>
              <div class="duration">Billed as one payment for <strong>12 Months</strong> access</div>
            </div>
          </div>
          <div style="text-align:right;color:var(--muted);font-size:12px">SAVE 75% â€¢ FREE 9 MONTHS</div>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <ul class="features">
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--cyan)"/></svg><div><strong>Unlimited Projects</strong><div style="color:var(--muted);font-size:13px">For creators & agencies who scale</div></div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/></svg><div>Access All Creative Styles</div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><div><strong>Creative Fusion & Wildcard AI</strong></div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="2"/></svg><div><strong>Priority</strong> Email Support</div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.6"/></svg><div>Free AI Director Masterclass</div></li>
        </ul>

        <div class="cta">
          <button class="btn" 
                  data-plan-id="pro_3m" 
                  data-plan-name="PRO Plan (12 Months)" 
                  data-amount="29700">Choose PRO</button>
        </div>
      </article>

      <article class="card" id="card-competent" aria-labelledby="comp-label">
        <div class="rim-highlight"></div>
        <div class="sheen" aria-hidden="true"></div>
        <div class="top">
          <div>
            <div id="comp-label" class="plan-name">Competent</div>
            <div class="priceWrap">
              <div class="price" id="price-competent">RM198</div>
              <div class="duration">Billed as one payment for <strong>6 Months</strong> access</div>
            </div>
          </div>
          <div style="text-align:right;color:var(--muted);font-size:12px">SAVE 67% â€¢ FREE 4 MONTHS</div>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <ul class="features">
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--cyan)"/></svg><div><strong>Unlimited Projects</strong><div style="color:var(--muted);font-size:13px">Balanced for ongoing workflows</div></div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/></svg><div>Access All Creative Styles</div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><div>Creative Fusion & Wildcard AI</div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="2"/></svg><div>Email Support</div></li>
          <li><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 7h18M3 12h10M3 17h6" stroke="currentColor" stroke-width="1.6"/></svg><div>Monthly Project Insights</div></li>
        </ul>

        <div class="cta">
          <button class="btn alt" 
                  data-plan-id="competent_2m" 
                  data-plan-name="Competent Plan (6 Months)" 
                  data-amount="19800">Choose Competent</button>
        </div>
      </article>
    </section>

    <p id="errorMessage" role="status" aria-live="polite" style="margin-top:18px; color: #ff5a5a;"></p>

    <section class="faq" aria-labelledby="faqTitle" style="margin-top:40px">
      <h2 id="faqTitle" style="text-align:center;font-size:26px;margin-bottom:18px;font-weight:800">Frequently Asked Questions</h2>
      <details><summary>Is this a one-time payment or a subscription?</summary><p>The plans listed are one-time payments for the specified access duration. Your access will expire, and you can purchase again. No automatic recurring charges.</p></details>
      <details><summary>What do I need to use the AI Film Director System?</summary><p>Just a web browser â€” project processing runs on our servers. To render final video you may need model credits (we provide docs).</p></details>
      <details><summary>What does "Unlimited Projects" mean?</summary><p>Create as many multi-scene projects as needed during your access period, subject to fair use.</p></details>
      <details><summary>Refund policy?</summary><p>Due to digital delivery and AI costs, refunds are not offered. Review features before purchasing.</p></details>
    </section>
  </div>

<script>
/* ============================
   API base (strict, no hardcoded fallback)
   ============================ */
function sanitizeBase(v){ if(!v||typeof v!=='string') return ''; v=v.trim(); if(!/^https?:\/\//i.test(v)) return ''; return v.replace(/\/+$/,''); }
function queryOverride(){ try{ const sp=new URLSearchParams(location.search); return (sp.get('pf_api_base')||sp.get('apiBase')||'').trim(); }catch{return '';} }
const API_BASE = sanitizeBase(queryOverride()) ||
                 sanitizeBase(localStorage.getItem('pf_api_base')||'') ||
                 sanitizeBase(window.PF_API_BASE || window.API_BASE_URL || window.API_ROOT || '');

/* ============================
   Purchase (aligned with dashboard)
   ============================ */
function getToken(){ return localStorage.getItem('jwtToken') || localStorage.getItem('token') || null; }
function planKeyFromCard(btn){
  // Determine plan by card container (safer than trusting inconsistent data attributes).
  const card = (btn && typeof btn.closest==='function') ? btn.closest('.card') : (function(n){ while(n && n!==document){ if(n.classList && n.classList.contains('card')) return n; n = n.parentElement; } return null; })(btn);
  if(!card) return null;
  if(card.id === 'card-beginner') return 'p1m';
  if(card.id === 'card-competent') return 'p6m';
  if(card.id === 'card-pro') return 'p12m';
  return null;
}

async function handlePurchase(btn){
  const errorMessage = document.getElementById('errorMessage');
  errorMessage.textContent = '';

  if (!API_BASE){
    errorMessage.textContent = 'API base is not set. Please contact admin.';
    return;
  }

  const token = getToken();
  if (!token) {
    alert('Please log in or register first to make a purchase.');
    const meta = {
      planId: btn.dataset.planId || '',
      planName: btn.dataset.planName || '',
      amountInSen: parseInt(btn.dataset.amount || '0', 10) || 0
    };
    localStorage.setItem('pendingPurchase', JSON.stringify(meta));
    window.location.href = 'login.html';
    return;
  }

  const planKey = planKeyFromCard(btn);
  if(!planKey){
    errorMessage.textContent = 'Unknown plan. Please refresh and try again.';
    return;
  }

  const allButtons = document.querySelectorAll('.cta .btn');
  allButtons.forEach(b => { b.disabled = true; if(b && b.dataset) b.dataset.orig = b.textContent; b.textContent = 'Processingâ€¦'; b.style.opacity='0.7'; b.style.cursor='wait'; });
  try {
    const res = await window.apiFetch('/create-bill', {
      method: 'POST',
      headers: { 'Content-Type':'application/json', 'Authorization': 'Bearer ' + token },
      body: JSON.stringify({ plan: planKey })
    });
    const data = await res.json().catch(()=>null);
    if (!res.ok) {
      const msg = (data && (data.error || data.detail || data.message)) || ('Failed to create payment link. Status: ' + res.status);
      throw new Error(msg);
    }
    if (data && data.url) {
      window.location.href = data.url;
      return;
    }
    throw new Error('No checkout URL returned by server.');
  } catch (err) {
    errorMessage.textContent = 'Error: ' + (err && err.message ? err.message : 'Please try again later.');
  } finally {
    allButtons.forEach(b => { b.disabled = false; b.textContent = (b && b.dataset && b.dataset.orig) ? b.dataset.orig : b.textContent; b.style.opacity='1'; b.style.cursor='pointer'; });
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const purchaseButtons = document.querySelectorAll('.cta .btn');
  purchaseButtons.forEach(button => {
    button.addEventListener('click', () => handlePurchase(button));
  });
});

/* ============================
   Visuals (unchanged from your base)
   ============================ */
(function(){
  const nebula = document.getElementById('nebula');
  const part = document.getElementById('particleLayer');
  const net = document.getElementById('network');
  const beamCanvas = document.getElementById('beamCanvas');
  const dpr = Math.min(window.devicePixelRatio || 1.5, 2);

  function fit(c){ if(!c) return; c.width = innerWidth * dpr; c.height = innerHeight * dpr; c.style.width = innerWidth + 'px'; c.style.height = innerHeight + 'px'; var ctx = c.getContext && c.getContext('2d'); if (ctx && ctx.setTransform) ctx.setTransform(dpr,0,0,dpr,0,0); }
  [nebula, part, net, beamCanvas].forEach(fit);
  window.addEventListener('resize', ()=>{ [nebula, part, net, beamCanvas].forEach(fit); initAll(); });

  const nCtx = (nebula && nebula.getContext) ? nebula.getContext('2d') : null;
  const pCtx = (part && part.getContext) ? part.getContext('2d') : null;
  const lCtx = (net && net.getContext) ? net.getContext('2d') : null;
  const bCtx = (beamCanvas && beamCanvas.getContext) ? beamCanvas.getContext('2d') : null;

  let mouse = { x: innerWidth/2, y: innerHeight/2 };
  window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; });

  let blobs = [];
  function initNebula(){
    blobs = [];
    const count = 6;
    for(let i=0;i<count;i++){
      blobs.push({
        x: Math.random()*innerWidth,
        y: Math.random()*innerHeight,
        rx: innerWidth * (0.25 + Math.random()*0.5),
        ry: innerHeight * (0.18 + Math.random()*0.4),
        hue: 220 + Math.random()*160,
        phase: Math.random()*Math.PI*2,
        speed: 0.0005 + Math.random()*0.001
      });
    }
  }

  let emitters = [];
  function initEmitters(){
    emitters = [
      { x: innerWidth*0.5, y: innerHeight*0.45, color:[139,92,246], parts: [] },
      { x: innerWidth*0.22, y: innerHeight*0.62, color:[255,63,166], parts: [] },
      { x: innerWidth*0.78, y: innerHeight*0.28, color:[65,217,255], parts: [] }
    ];
  }

  function spawn(p, color){
    const ang = Math.random()*Math.PI*2;
    const sp = 1.4 + Math.random()*6.0;
    return { x: p.x + (Math.random()-0.5)*6, y: p.y + (Math.random()-0.5)*6, vx: Math.cos(ang)*sp, vy: Math.sin(ang)*sp, r: 1 + Math.random()*3.6, life: 700 + Math.random()*900, age:0, color };
  }

  let nodes = [];
  function initNetwork(){
    nodes = [];
    const count = Math.max(18, Math.floor(innerWidth/80));
    for(let i=0;i<count;i++){
      nodes.push({ x: Math.random()*innerWidth, y: Math.random()*innerHeight, vx:(Math.random()*2-1)*0.2, vy:(Math.random()*2-1)*0.2 });
    }
  }

  function initAll(){ initNebula(); initEmitters(); initNetwork(); }
  initAll();

  function drawNebula(){ if(!nCtx) return;
    nCtx.clearRect(0,0,innerWidth,innerHeight);
    const g = nCtx.createLinearGradient(0,0,innerWidth,innerHeight);
    g.addColorStop(0, 'rgba(6,6,10,0.28)');
    g.addColorStop(1, 'rgba(10,12,30,0.28)');
    nCtx.fillStyle = g; nCtx.fillRect(0,0,innerWidth,innerHeight);

    blobs.forEach((b,i) => {
      b.phase += b.speed;
      const ox = Math.sin(b.phase*1.2 + i)*90;
      const oy = Math.cos(b.phase*0.9 + i)*60;
      const cx = b.x + ox + (mouse.x - innerWidth/2)*0.02*(i%2? -1:1);
      const cy = b.y + oy + (mouse.y - innerHeight/2)*0.02*(i%2? 1:-1);
      const rx = b.rx * (0.9 + Math.sin(b.phase*0.7)*0.08);
      const ry = b.ry * (0.9 + Math.cos(b.phase*0.5)*0.06);
      const grad = nCtx.createRadialGradient(cx,cy,Math.min(rx,ry)*0.06, cx,cy, Math.max(rx,ry));
      const h = Math.floor(b.hue);
      grad.addColorStop(0, `hsla(${h},85%,65%,0.20)`);
      grad.addColorStop(0.4, `hsla(${(h+40)%360},80%,55%,0.10)`);
      grad.addColorStop(1, 'rgba(6,6,12,0)');
      nCtx.save(); nCtx.globalCompositeOperation = 'screen'; nCtx.fillStyle = grad;
      nCtx.beginPath(); nCtx.ellipse(cx,cy,rx,ry,0,0,Math.PI*2); nCtx.fill(); nCtx.restore();
    });
  }

  function drawParticles(delta){ if(!pCtx) return;
    pCtx.clearRect(0,0,innerWidth,innerHeight);
    pCtx.globalCompositeOperation = 'lighter';
    emitters.forEach(em => {
      em.x += Math.sin(Date.now()*0.0003 + em.x*0.00001)*0.2;
      em.y += Math.cos(Date.now()*0.00027 + em.y*0.00001)*0.25;
      if(Math.random() < 0.12) em.parts.push(spawn(em, em.color));
      if(Math.random() < 0.0008) for(let k=0;k<14;k++) em.parts.push(spawn(em, em.color));
      for(let i=em.parts.length-1;i>=0;i--){
        const p = em.parts[i]; p.age += delta;
        p.vx *= 0.995; p.vy *= 0.995;
        p.x += p.vx; p.y += p.vy;
        const lifeRatio = Math.max(0, 1 - p.age/p.life);
        pCtx.beginPath();
        pCtx.fillStyle = `rgba(${p.color[0]},${p.color[1]},${p.color[2]},${0.85 * lifeRatio})`;
        pCtx.arc(p.x, p.y, Math.max(0.3, p.r*(0.6 + (1-lifeRatio)*1.4)), 0, Math.PI*2);
        pCtx.fill();
        if(p.age > p.life) em.parts.splice(i,1);
      }
    });
    pCtx.globalCompositeOperation = 'source-over';
  }

  function drawNetwork(){ if(!lCtx) return;
    lCtx.clearRect(0,0,innerWidth,innerHeight);
    nodes.forEach(n => {
      n.x += n.vx + (mouse.x - n.x) * 0.00012;
      n.y += n.vy + (mouse.y - n.y) * 0.00012;
      if(n.x < -10) n.x = innerWidth + 10; if(n.x > innerWidth + 10) n.x = -10;
      if(n.y < -10) n.y = innerHeight + 10; if(n.y > innerHeight + 10) n.y = -10;
    });
    lCtx.beginPath();
    nodes.forEach((a,i) => {
      for(let j=i+1;j<nodes.length;j++){
        const b = nodes[j];
        const d = Math.hypot(a.x-b.x, a.y-b.y);
        if(d < 180){
          const alpha = 0.08 * (1 - d/180);
          lCtx.strokeStyle = `rgba(139,92,246,${alpha})`;
          lCtx.lineWidth = 0.6;
          lCtx.moveTo(a.x,a.y); lCtx.lineTo(b.x,b.y);
        }
      }
    });
    lCtx.stroke(); lCtx.closePath();
    lCtx.beginPath();
    const t = Date.now()*0.0006;
    for(let x=0;x<innerWidth;x+=12){
      const y = innerHeight*0.5 + Math.sin((x*0.007)+t) * 140 + Math.cos((x*0.002)+t*1.4)*36;
      if(x===0) lCtx.moveTo(x,y); else lCtx.lineTo(x,y);
    }
    lCtx.strokeStyle = 'rgba(255,255,255,0.02)'; lCtx.lineWidth = 1.2; lCtx.stroke();
  }

  let last = performance.now();
  function frame(now){
    const delta = now - last; last = now;
    drawNebula();
    drawParticles(delta);
    drawNetwork();
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);

  const r1 = document.getElementById('r1'), r2 = document.getElementById('r2');
  let start = Date.now();
  (function animRibbons(){
    const tt = (Date.now() - start) * 0.00008;
    if(r1) r1.setAttribute('transform', `translate(${Math.sin(tt*1.3)*60}, ${Math.cos(tt*0.9)*18}) rotate(${Math.sin(tt)*2})`);
    if(r2) r2.setAttribute('transform', `translate(${Math.cos(tt*1.1)*80}, ${Math.sin(tt*0.7)*15}) rotate(${Math.cos(tt)*1.2})`);
    requestAnimationFrame(animRibbons);
  })();

  function playBeamBlast(){
    const ctx = bCtx;
    const W = beamCanvas.width / dpr, H = beamCanvas.height / dpr;
    let start = performance.now();
    const beams = 28;
    function drawBlast(ts){
      const t = ts - start;
      ctx.clearRect(0,0,beamCanvas.width,beamCanvas.height);
      ctx.save();
      ctx.scale(dpr,dpr);
      const flashAlpha = Math.max(0, 1 - t/650);
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255, ${0.25 * flashAlpha})`;
      ctx.fillRect(0,0,W,H);
      ctx.closePath();
      const cx = W/2, cy = H/2;
      for(let i=0;i<beams;i++){
        const ang = (i / beams) * Math.PI*2 + (t*0.004);
        const len = 0.8 + Math.sin(t*0.02 + i) * 0.25;
        const x2 = cx + Math.cos(ang) * W * len;
        const y2 = cy + Math.sin(ang) * H * len;
        ctx.beginPath();
        const grad = ctx.createLinearGradient(cx,cy,x2,y2);
        grad.addColorStop(0, `rgba(255,250,230, ${0.45 * (1 - t/1200)})`);
        grad.addColorStop(0.4, `rgba(255,200,120, ${0.22 * (1 - t/1200)})`);
        grad.addColorStop(1, 'rgba(255,200,120,0)');
        ctx.strokeStyle = grad;
        var lw = 6 * (1 - t/1200); if (lw < 0.1) lw = 0.1; ctx.lineWidth = lw;
        ctx.moveTo(cx,cy); ctx.lineTo(x2,y2); ctx.stroke(); ctx.closePath();
      }
      ctx.restore();
      if(t < 1200) requestAnimationFrame(drawBlast); else ctx.clearRect(0,0,beamCanvas.width,beamCanvas.height);
    }
    requestAnimationFrame(drawBlast);
  }
  window.addEventListener('load', ()=>{ setTimeout(playBeamBlast, 260); });

  function createExplosionAt(elem, theme){
    if(!elem) return;
    const rect = elem.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const c = document.createElement('canvas');
    const s = 1; 
    c.width = rect.width * 2;
    c.height = rect.height * 2;
    c.style.position = 'fixed';
    c.style.left = (cx - rect.width) + 'px';
    c.style.top = (cy - rect.height) + 'px';
    c.style.width = rect.width*2 + 'px';
    c.style.height = rect.height*2 + 'px';
    c.style.pointerEvents = 'none';
    c.style.zIndex = 9999;
    document.body.appendChild(c);
    const ctx = c.getContext('2d');
    let particles = [];
    const baseColor = (theme === 'gold') ? [[255,200,120],[253,160,133]] : [[139,92,246],[255,63,166]];
    const count = 48 + Math.floor(Math.random()*36);
    for(let i=0;i<count;i++){
      const ang = Math.random()*Math.PI*2;
      const speed = 2 + Math.random()*10;
      const col = baseColor[i%baseColor.length];
      particles.push({
        x: c.width/2, y: c.height/2,
        vx: Math.cos(ang)*speed + (Math.random()-0.5)*1.8,
        vy: Math.sin(ang)*speed + (Math.random()-0.5)*1.8,
        r: 1 + Math.random()*3.6,
        life: 500 + Math.random()*900,
        age: 0,
        color: col
      });
    }
    let start = performance.now();
    function explode(now){
      const t = now - start;
      const dt = 16;
      ctx.clearRect(0,0,c.width,c.height);
      const gg = ctx.createRadialGradient(c.width/2,c.height/2,0,c.width/2,c.height/2,c.width*0.5);
      gg.addColorStop(0, 'rgba(255,255,255,0.25)');
      gg.addColorStop(0.2, 'rgba(255,255,255,0.08)');
      gg.addColorStop(1, 'rgba(255,255,255,0)');
      ctx.fillStyle = gg; ctx.fillRect(0,0,c.width,c.height);
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.age += dt;
        p.vx *= 0.985; p.vy *= 0.985;
        p.x += p.vx; p.y += p.vy;
        const lifeRatio = Math.max(0, 1 - p.age/p.life);
        ctx.beginPath();
        ctx.fillStyle = `rgba(${p.color[0]},${p.color[1]},${p.color[2]},${0.95 * lifeRatio})`;
        ctx.arc(p.x, p.y, Math.max(0.2, p.r * (0.6 + (1-lifeRatio)*1.6)), 0, Math.PI*2);
        ctx.fill();
        if(p.age > p.life) particles.splice(i,1);
      }
      if(particles.length > 0) requestAnimationFrame(explode); else { document.body.removeChild(c); }
    }
    requestAnimationFrame(explode);
  }

  function bindCardExplosions(){
    const cards = [
      { card: document.getElementById('card-beginner'), price: document.getElementById('price-beginner'), theme:'neon' },
      { card: document.getElementById('card-pro'), price: document.getElementById('price-pro'), theme:'gold' },
      { card: document.getElementById('card-competent'), price: document.getElementById('price-competent'), theme:'neon' }
    ];
    cards.forEach(({card, price, theme}) => {
      if(!card || !price) return;
      setTimeout(()=>{ price.classList.add('pop'); createExplosionAt(price, theme); setTimeout(()=>price.classList.remove('pop'), 800); }, 500 + Math.random()*400);
      card.addEventListener('mouseenter', ()=> {
        price.classList.add('pop');
        createExplosionAt(price, theme);
        setTimeout(()=> price.classList.remove('pop'), 900);
      });
      card.addEventListener('focusin', ()=> {
        price.classList.add('pop');
        createExplosionAt(price, theme);
        setTimeout(()=> price.classList.remove('pop'), 900);
      });
    });
  }
  window.addEventListener('load', ()=>{ bindCardExplosions(); });

})();
</script>
</body>
</html>
